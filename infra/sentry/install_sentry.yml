---
- name: Install Sentry server
  hosts: sentry
  become: true
  tasks:
    - import_tasks: tasks/install_docker.yml
      tags:
        - 'docker'

    - import_tasks: tasks/install_git.yml
      tags:
        - 'git'

    - name: Create Sentry directory
      file:
        path: /opt/sentry
        state: directory
      tags:
        - 'sentry'

    - name: Clone Sentry project
      git:
        repo: 'https://github.com/getsentry/onpremise'
        dest: /opt/sentry
      tags:
        - 'sentry'

    - name: Copy sentry conf file
      template:
        src: sentry.conf.py.j2
        dest: /opt/sentry/sentry.conf.py

    - name: Run Sentry install.sh
      command: